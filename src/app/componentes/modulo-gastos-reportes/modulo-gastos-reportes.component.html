<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reporte de Gastos</title>
  <link rel="stylesheet" href="modulo-gastos-reportes.component.css"> <!-- Asegúrate de vincular tu archivo CSS aquí -->
</head>
<body>
  <div>
    <app-navigation-bar-administrador></app-navigation-bar-administrador>
  </div>
  <div class="container mt-5">
    <h1 class="text-center mb-4 title-text">Reporte de Gastos</h1>

    <div class="filter-container mb-4">
      <div class="filter-row">
        <mat-form-field appearance="fill" class="mr-2">
          <mat-label>Fecha de Inicio</mat-label>
          <input matInput [matDatepicker]="startPicker" (dateChange)="onStartDateChange($event)">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill" class="ml-2">
          <mat-label>Fecha de Fin</mat-label>
          <input matInput [matDatepicker]="endPicker" (dateChange)="onEndDateChange($event)">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="filter-row mt-2">
        <mat-form-field appearance="fill" class="mr-2">
          <mat-label>Concepto</mat-label>
          <input matInput (input)="onConceptoChange($event)" placeholder="Filtrar por concepto">
        </mat-form-field>

        <mat-form-field appearance="fill" class="ml-2">
          <mat-label>Forma de Pago</mat-label>
          <mat-select (selectionChange)="onFormaPagoChange($event)">
            <mat-option value="todas">Todas</mat-option> <!-- Opción añadida -->
            <mat-option *ngFor="let forma of formasPago" [value]="forma.descripcion">
              {{ forma.descripcion }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="total-gastos-hoy">
      <p>Total de gastos: <strong>{{ totalGastosHoy | currency }}</strong></p>
    </div>

    <button mat-raised-button color="primary" (click)="exportarGastosHoyExcel()" [disabled]="!hasGastosHoy">
      Exportar Gastos a Excel
    </button>

    <div class="mat-elevation-z4 fichas-container">
      <div *ngIf="!hasGastosHoy" class="no-gastos-msg">
        <p>No hay gastos para el rango de fechas, concepto o forma de pago seleccionado</p>
      </div>
      <table *ngIf="hasGastosHoy" mat-table [dataSource]="filteredGastos" class="mat-elevation-z8">
        <!-- Concepto Column -->
        <ng-container matColumnDef="concepto">
          <th mat-header-cell *matHeaderCellDef> Concepto </th>
          <td mat-cell *matCellDef="let gasto"> {{ gasto.concepto }} </td>
        </ng-container>

        <!-- Fecha Column -->
        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef> Fecha </th>
          <td mat-cell *matCellDef="let gasto"> {{ gasto.fecha | date:'short' }} </td>
        </ng-container>

        <!-- Forma de Pago Column -->
        <ng-container matColumnDef="forma_pago">
          <th mat-header-cell *matHeaderCellDef> Forma de Pago </th>
          <td mat-cell *matCellDef="let gasto"> {{ gasto.forma_pago.descripcion }} </td>
        </ng-container>

        <!-- Monto Column -->
        <ng-container matColumnDef="monto">
          <th mat-header-cell *matHeaderCellDef> Monto </th>
          <td mat-cell *matCellDef="let gasto"> {{ gasto.monto | currency }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </div>
</body>
</html>
